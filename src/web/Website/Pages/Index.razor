@page "/"
@namespace DadABase.Web.Pages

<PageTitle>@Data.Constants.ApplicationTitle</PageTitle>

<div class="page-container">
    <Row Style="width: 100%;">
        <Column ColumnSize="ColumnSize.Is10.OnDesktop.Is12.OnTablet.Is12.OnMobile" Style="margin: 0 auto;">
            <h1>Tell me a Joke, Dad!</h1>
            <LoadingIndicator @ref="jokeLoadingIndicator">
                <div class="joke-container">
                    <ul id="jokeList" style="list-style-type: none; padding: 0;">
                      <li><JokeDisplayComponent myJoke="@myJoke" /></li>
                    </ul>
                </div>
            </LoadingIndicator>
            <div class="button-group">
                <button class="btn btn-primary" @onclick="ExecuteRandom">Tell me another one!</button>

                @if (imageDescriptionGenerated && showButtons)
                {
                    <button class="btn btn-primary" @onclick="CreatePicture">Paint me a picture!</button>
                }
            </div>
            <div class="joke-image-section">
                <p style="font-size: 1.2em; font-style: italic; color: #667eea;">@jokeImageMessage</p>
                @if (imageGenerating)
                {
                  <p style="font-size: 0.9em; color: #718096;">@jokeImageDescription</p>
                }
                <LoadingIndicator @ref="imageLoadingIndicator">
                    @if (!string.IsNullOrEmpty(jokeImageUrl)) {
                      <img src="@jokeImageUrl" class="joke-image" width="400" style="cursor: pointer;" @onclick="ShowImageDescriptionPopup" />
                    }
                    else if (!string.IsNullOrEmpty(jokeImageDescription))
                    {
                      <p style="font-size: 0.9em; color: #718096;">@jokeImageDescription</p>
                    }
                </LoadingIndicator>
            </div>
        <Modal @ref="imageDescriptionPopup">
            <ModalContent Centered>
                <ModalHeader>
                    <ModalTitle>Image Description</ModalTitle>
                    <CloseButton />
                </ModalHeader>
                <ModalBody>
                    <p>@jokeImageDescription</p>
                </ModalBody>
                <ModalFooter>
                    <Button Color="Color.Secondary" Clicked="@CloseImageDescriptionPopup">Close</Button>
                </ModalFooter>
            </ModalContent>
        </Modal>



            @if (jokeHistory.Any())
            {
                <div class="history-section">
                    <h5 class="history-toggle"
                        tabindex="0"
                        @onclick="ToggleHistory"
                        @onkeydown="@(e => { if (e.Key == "Enter" || e.Key == " ") ToggleHistory(); })">
                        Joke History
                        <span style="margin-left: 8px; font-size: 1.2em;">
                            @(isHistoryCollapsed ? "👁️" : "🙈")
                        </span>
                    </h5>
                    @if (!isHistoryCollapsed)
                    {
                        <ul style="list-style-type: none; padding: 0;">
                            @foreach (var joke in jokeHistory)
                            {
                                <li><JokeDisplayComponent myJoke="@joke" /></li>
                            }
                        </ul>
                    }
                </div>
            }
        </Column>
    </Row>
</div>
<SnackbarStack @ref="snackbarstack" Location="SnackbarStackLocation.BottomEnd" />
