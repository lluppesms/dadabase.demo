@page "/"
@namespace DadABase.Web.Pages
@using MudBlazor

<PageTitle>@(isNinetiesTheme ? "The Grand-Dad-A-Base" : Data.Constants.ApplicationTitle)</PageTitle>

<div class="page-container">
    <MudContainer MaxWidth="MaxWidth.Large">
        <h1>@(isNinetiesTheme ? "Tell me a Joke, Grandpa!" : "Tell me a Joke, Dad!")</h1>
        @if (jokeLoading)
        {
            <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
        }
        else
        {
            <div class="joke-container">
                <ul id="jokeList" style="list-style-type: none; padding: 0;">
                  <li><JokeDisplayComponent myJoke="@myJoke" /></li>
                </ul>
            </div>
        }
            <div class="button-group">
                <button class="btn btn-primary" @onclick="ExecuteRandom" disabled="@imageLoading">Tell me another one!</button>
                @if (!isNinetiesTheme)
                {
                    <button class="btn btn-primary" @onclick="GenerateAIImage" disabled="@(imageLoading || imageGenerated)" title="Let the DadJoke AI imagine this scenario for you!">@(string.IsNullOrEmpty(myJoke?.ImageTxt) ? "AI Image Generator" : "AI Imagine-a-tor")</button>
                }
            </div>
            @if (isNinetiesTheme)
            {
                <div style="text-align: center; margin-top: 20px;">
                    <a href="https://en.wikipedia.org/wiki/Dancing_baby" target="_blank" style="text-decoration: none;">
                        <img src="/DancingBaby.gif" alt="Dancing Baby" style="max-width: 200px; cursor: pointer;" />
                    </a>
                </div>
            }
            <div class="joke-image-section">
                <p class="image-message">@jokeImageMessage</p>
                @if (imageLoading)
                {
                    <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
                    @if (!string.IsNullOrEmpty(jokeImageDescription))
                    {
                        <p class="image-note">@jokeImageDescription</p>
                    }
                }
                else
                {
                    @if (!string.IsNullOrEmpty(jokeImageUrl)) {
                      <img src="@jokeImageUrl" class="joke-image" width="400" style="cursor: pointer;" @onclick="ShowImageDescriptionPopup" title="@jokeImageDescription" />
                    }
                    else if (!string.IsNullOrEmpty(jokeImageDescription))
                    {
                        <p class="image-note">@jokeImageDescription</p>
                    }
                }
            </div>
        <MudDialog @bind-Visible="@imageDescriptionDialogVisible">
            <TitleContent>
                <MudText Typo="Typo.h6">Image Description</MudText>
            </TitleContent>
            <DialogContent>
                <p>@jokeImageDescription</p>
            </DialogContent>
            <DialogActions>
                <MudButton Color="Color.Secondary" OnClick="@CloseImageDescriptionPopup">Close</MudButton>
            </DialogActions>
        </MudDialog>



            @if (jokeHistory.Any())
            {
                <div class="history-section">
                    <h5 class="history-toggle"
                        tabindex="0"
                        @onclick="ToggleHistory"
                        @onkeydown="@(e => { if (e.Key == "Enter" || e.Key == " ") ToggleHistory(); })">
                        Joke History
                        <span style="margin-left: 8px; font-size: 1.2em;">
                            @(isHistoryCollapsed ? "👁️" : "🙈")
                        </span>
                    </h5>
                    @if (!isHistoryCollapsed)
                    {
                        <ul style="list-style-type: none; padding: 0;">
                            @foreach (var joke in jokeHistory)
                            {
                                <li><JokeDisplayComponent myJoke="@joke" /></li>
                            }
                        </ul>
                    }
                </div>
            }
    </MudContainer>
</div>
